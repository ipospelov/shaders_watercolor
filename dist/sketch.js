var buffer,myCanvas,windowEdgeSize,palette,loadingBuffer,myScene,xBufferSize=2e3,ratio=1.25,yBufferSize=xBufferSize*ratio,frameWidth=100,xi=0,yi=0,isCaptured=!1,stages=[{stage:"filling",iters:2,title:"Stage 1/3 - coloring",step:[19,21]},{stage:"drawing",iters:1,title:"Stage 2/3 - texturing",step:[19,21]},{stage:"filling",iters:3,title:"Stage 3/3 - coloring",step:[19,21]}],currIter=0,currStage=0;function setup(){var e,r;frameRate(60),windowHeight/windowWidth>=ratio?(e=windowWidth,r=windowWidth*ratio):(e=windowHeight/ratio,r=windowHeight),(myCanvas=createCanvas(e,r)).id("mycanvas"),(buffer=createGraphics(xBufferSize,yBufferSize)).pixelDensity(1),buffer.width=e,buffer.height=r,myCanvas.style("display","block"),palette=palettes[paletteIndex],noiseSeed(fxRandRanged(-2e3,2e3)),(loadingBuffer=createGraphics(370,30)).pixelDensity(2),loadingBuffer.textSize(20),loadingBuffer.stroke(0),loadingBuffer.strokeWeight(4),loadingBuffer.fill(255),myScene=new sceneClass,buffer.background(0),console.log("Made with 🤍 by @ivposure")}function windowResized(){var e,r;windowHeight/windowWidth>=ratio?(e=windowWidth,r=windowWidth*ratio):(e=windowHeight/ratio,r=windowHeight),resizeCanvas(e,r),buffer.width=e,buffer.height=r,image(buffer,0,0)}function drawIsoline(e,r){var f=myScene.getPointStyle(e,r),a=f.area;myScene.setDefaultArea(a),buffer.noFill(),buffer.beginShape(POINTS),buffer.strokeWeight(2);var t=f.color;for(buffer.stroke(t,150),i=0;i<100;i++){var n=(f=myScene.getPointStyle(e,r)).area;if(myScene.isLeftArea(n))break;buffer.curveVertex(e,r);var d=f.noise,u=map(d,0,1,0,2*Math.PI);e+=1*Math.cos(u),r+=1*Math.sin(u)}buffer.endShape()}function drawFrameBorder(){var e=frameWidth,r=xBufferSize-frameWidth,f=frameWidth;buffer.strokeWeight(1),buffer.stroke(0);var a=800,i=200;buffer.beginShape(POINTS);for(var t=0;t<a;t++)for(var n=e;n<=r;n+=10){var d=f-fxrand()*fxrand()*fxrand()*i,u=Math.max(frameWidth-d,5),o=n+fxRandRanged(-u,u);buffer.curveVertex(o,d)}for(buffer.endShape(),e=frameWidth,r=xBufferSize-frameWidth,f=yBufferSize-frameWidth,buffer.beginShape(POINTS),t=0;t<a;t++)for(n=e;n<=r;n+=10)d=f+fxrand()*fxrand()*fxrand()*i,u=Math.max(d-(yBufferSize-frameWidth),5),o=n+fxRandRanged(-u,u),buffer.curveVertex(o,d);buffer.endShape(),n=frameWidth;var g=frameWidth,s=yBufferSize-frameWidth;for(buffer.beginShape(POINTS),t=0;t<a;t++)for(f=g;f<=s;f+=10){o=n-fxrand()*fxrand()*fxrand()*i;var l=Math.max(frameWidth-o,5);d=f+fxRandRanged(-l,l),buffer.curveVertex(o,d)}for(buffer.endShape(),n=xBufferSize-frameWidth,g=frameWidth,s=yBufferSize-frameWidth,buffer.beginShape(POINTS),t=0;t<a;t++)for(f=g;f<=s;f+=10)o=n+fxrand()*fxrand()*fxrand()*i,l=Math.max(o-(xBufferSize-frameWidth),5),d=f+fxRandRanged(-l,l),buffer.curveVertex(o,d);buffer.endShape()}function fillAreas(e,r){buffer.noFill(),currIter>=2?buffer.strokeWeight(2):buffer.strokeWeight(2.6);var f=e,a=r;for(buffer.beginShape(POINTS),i=0;i<40&&(f+=fxRandRanged(-30,30),a+=fxRandRanged(-30,30),!(f<0||f>xBufferSize))&&!(a<0||a>yBufferSize);i++){var t=myScene.getFillColor(f,a);buffer.stroke(...t),buffer.curveVertex(f,a)}buffer.endShape()}var nStills=30,currStill=0;function draw(){if(!isCaptured){for(let a=0;a<120;a++){if(currStage>=stages.length){if(!isCaptured){if(loadingBuffer.clear(),drawFrameBorder(),image(buffer,0,0),fxpreview(),isCaptured=!0,!(currStill<nStills))return;currStill++}return}var e=stages[currStage].stage,r=stages[currStage].iters;"drawing"==e?drawIsoline(xi,yi):"filling"==e&&fillAreas(xi,yi);var f=stages[currStage].step;(xi+=fxRandRanged(...f))>xBufferSize&&(xi=0,yi+=fxRandRanged(...f)),yi>=yBufferSize&&(yi=0,currIter++),r<=currIter&&(currIter=0,currStage++)}if(image(buffer,0,0),currStage<stages.length){var a=stages[currStage].title,i=Math.max(1,yi)/yBufferSize*1/r+currIter/r;i=Math.round(100*i),loadingBuffer.clear(),loadingBuffer.text(`${a} ${i}%`,5,23),image(loadingBuffer,0,0)}}}function keyTyped(){"s"===key&&save(buffer,"crisitiva.png")}